I"æQ<p>La mÃ¡quina Brookling99 es una mÃ¡quina de TryHackMe en la que mediante la explotaciÃ³n de un servidor web conseguimos tanto la flag del usuario como la de root.</p>

<h1 id="enumeraciÃ³n"><a href="#header-1"></a>EnumeraciÃ³n</h1>

<p>La enumeraciÃ³n se trata de una de las fases principales, en las que recolectamos la mÃ¡xima informaciÃ³n posible de la mÃ¡quina vÃ­ctima.</p>

<p>Usaremos nmap para analizar los puertos abiertos:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nv">$IP</span><span class="nt">-VICTIMA</span> <span class="nt">-oG</span> allPorts
</code></pre></div></div>

<ul>
  <li>
    <p>Escaneo todos los puertos abiertos: -p- â€“open</p>
  </li>
  <li>
    <p>Mediante â€“min-rate 5000 indicamos que queremos emitir paquetes no mÃ¡s lentos que 5000 paquetes por segundo.</p>
  </li>
  <li>
    <p>Triple verbose (-vvv) para que vaya reportando por consola los puertos abiertos y no tener que esperar al final del escaneo.</p>
  </li>
  <li>
    <p>Para que el escaneo no aplique resoluciÃ³n DNS usamos -n</p>
  </li>
  <li>
    <p>En mi caso exporto los puertos abiertos en formato grepeable (-oG) al archivo allPorts</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Host discovery disabled <span class="o">(</span><span class="nt">-Pn</span><span class="o">)</span><span class="nb">.</span> All addresses will be marked <span class="s1">'up'</span> and scan <span class="nb">times </span>may be slower.
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-10-14 06:22 EDT
Initiating Connect Scan at 06:22
Scanning 10.10.209.206 <span class="o">[</span>65535 ports]
Discovered open port 22/tcp on 10.10.209.206
Discovered open port 21/tcp on 10.10.209.206
Discovered open port 80/tcp on 10.10.209.206
Stats: 0:00:14 elapsed<span class="p">;</span> 0 hosts completed <span class="o">(</span>1 up<span class="o">)</span>, 1 undergoing Connect Scan
Connect Scan Timing: About 76.50% <span class="k">done</span><span class="p">;</span> ETC: 06:23 <span class="o">(</span>0:00:05 remaining<span class="o">)</span>
Completed Connect Scan at 06:23, 19.84s elapsed <span class="o">(</span>65535 total ports<span class="o">)</span>
Nmap scan report <span class="k">for </span>10.10.209.206
Host is up, received user-set <span class="o">(</span>0.058s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2022-10-14 06:22:57 EDT <span class="k">for </span>19s
Not shown: 40658 closed tcp ports <span class="o">(</span>conn-refused<span class="o">)</span>, 24874 filtered tcp ports <span class="o">(</span>no-response<span class="o">)</span>
Some closed ports may be reported as filtered due to <span class="nt">--defeat-rst-ratelimit</span>
PORT   STATE SERVICE REASON
21/tcp open  ftp     syn-ack
22/tcp open  ssh     syn-ack
80/tcp open  http    syn-ack

Read data files from: /usr/bin/../share/nmap
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>19.89 seconds
</code></pre></div></div>

<p>Nos reporta una serie de puertos abiertos. Debido a que el puerto 80 estÃ¡ abierto, introducimos la $IP-VICTIMA en un buscador y nos reporta una imagen con el tÃ­tulo de la mÃ¡quina junto a un pequeÃ±o texo. El texto no nos da informaciÃ³n por lo que checkeamos la consola para tratar de conseguir algo mÃ¡s.</p>

<p>Conseguimos obtener un comentario en la consola que dice:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Have you ever heard of steganography?
</code></pre></div></div>
<p>Lo tendremos en cuenta. A parte del puerto 80, estÃ¡n abiertos el 21 y 22. En el puerto 21 estÃ¡ corriedno un servicio ftp por lo que vamos a realizar un escaneo con nmap para obtener mÃ¡s informaciÃ³n de estos:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â¯ nmap <span class="nt">-sCV</span> <span class="nt">-p21</span>,22,80 10.10.209.206 <span class="nt">-oN</span> targeted
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-10-14 06:27 EDT
Nmap scan report <span class="k">for </span>10.10.209.206
Host is up <span class="o">(</span>0.049s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.8.79.39
|      Logged <span class="k">in </span>as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session <span class="nb">timeout </span><span class="k">in </span>seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 1
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
| ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
|_-rw-r--r--    1 0        0             119 May 17  2020 note_to_jake.txt
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 16:7f:2f:fe:0f:ba:98:77:7d:6d:3e:b6:25:72:c6:a3 <span class="o">(</span>RSA<span class="o">)</span>
|   256 2e:3b:61:59:4b:c4:29:b5:e8:58:39:6f:6f:e9:9b:ee <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 ab:16:2e:79:20:3c:9b:0a:01:9c:8c:44:26:01:58:04 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp open  http    Apache httpd 2.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-title: Site doesn<span class="s1">'t have a title (text/html).
|_http-server-header: Apache/2.4.29 (Ubuntu)
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 9.23 seconds
[1]    4872 segmentation fault  nmap -sCV -p21,22,80 10.10.209.206 -oN targeted
</span></code></pre></div></div>

<p>Parece ser que nos podemos logear con el usuario Anonyous y sin contraseÃ±a. AdemÃ¡s existe un archivo .txt</p>

<p>Nos conectamos entonces con ese usuario y sin contraseÃ±a:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â¯ ftp 10.10.209.206
Connected to 10.10.209.206.
220 <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
Name <span class="o">(</span>10.10.209.206:jorge<span class="o">)</span>: anonymous
331 Please specify the password.
Password: 
230 Login successful.
Remote system <span class="nb">type </span>is UNIX.
Using binary mode to transfer files.
ftp&gt; 
</code></pre></div></div>

<p>Listamos el contendio y nos aparece el archivo .txt</p>

<p>Usando el comando get nos la podemos pasar a nuestro equipo. La abrimos y vemos su contenido:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp&gt; <span class="nb">ls
</span>229 Entering Extended Passive Mode <span class="o">(||</span>|30950|<span class="o">)</span>
150 Here comes the directory listing.
<span class="nt">-rw-r--r--</span>    1 0        0             119 May 17  2020 note_to_jake.txt
226 Directory send OK.
ftp&gt; get note_to_jake.txt
<span class="nb">local</span>: note_to_jake.txt remote: note_to_jake.txt
229 Entering Extended Passive Mode <span class="o">(||</span>|13605|<span class="o">)</span>
150 Opening BINARY mode data connection <span class="k">for </span>note_to_jake.txt <span class="o">(</span>119 bytes<span class="o">)</span><span class="nb">.</span>
100% |<span class="k">********************************************************</span>|   119       34.03 KiB/s    00:00 ETA
226 Transfer complete.
119 bytes received <span class="k">in </span>00:00 <span class="o">(</span>2.18 KiB/s<span class="o">)</span>
</code></pre></div></div>

<p>Lo abrimos en nuestro equipo:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â¯ <span class="nb">cat </span>note_to_jake.txt
â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       â”‚ File: note_to_jake.txt
â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   1   â”‚ From Amy,
   2   â”‚ 
   3   â”‚ Jake please change your password. It is too weak and holt will be mad <span class="k">if </span>someone hack into 
       â”‚ the nine nine
   4   â”‚ 
   5   â”‚ 
â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content_section_text"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;p&gt;</span>
                Please use the <span class="nt">&lt;tt&gt;</span>ubuntu-bug<span class="nt">&lt;/tt&gt;</span> tool to report bugs in the
                Apache2 package with Ubuntu. However, check <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://bugs.launchpad.net/ubuntu/+source/apache2"</span><span class="nt">&gt;</span>existing
                bug reports<span class="nt">&lt;/a&gt;</span> before reporting a new bug.
          <span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;REDACTED1&gt;</span>:<span class="nt">&lt;REDACTED2&gt;</span>
         <span class="c">&lt;!--(Check console for extra surprise!)--&gt;</span>
      <span class="nt">&lt;/REDACTED2&gt;&lt;/REDACTED1&gt;</span>
</code></pre></div></div>

<p>Parece ser que hay un usuario y contraseÃ±a entre los dos puntos antes del comentario. Intentaremos entonces usar SSH para conectarnos.</p>

<h1 id="acceso-al-sistema"><a href="$header-1"></a>Acceso al sistema</h1>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â¯ ssh ???????@10.10.224.44
The authenticity of host <span class="s1">'10.10.224.44 (10.10.224.44)'</span> can<span class="s1">'t be established.
ED25519 key fingerprint is SHA256:pLr5hKfcRZWD4ZBMz/8vFWnJ2xslYHSX94C4KXwOLVg.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:6: [hashed name]
    ~/.ssh/known_hosts:8: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>10.10.224.44<span class="s1">' (ED25519) to the list of known hosts.
pokemon@10.10.224.44'</span>s password: 
Welcome to Ubuntu 16.04.6 LTS <span class="o">(</span>GNU/Linux 4.15.0-112-generic x86_64<span class="o">)</span>

 <span class="k">*</span> Documentation:  https://help.ubuntu.com
 <span class="k">*</span> Management:     https://landscape.canonical.com
 <span class="k">*</span> Support:        https://ubuntu.com/advantage

84 packages can be updated.
0 updates are security updates.


The programs included with the Ubuntu system are free software<span class="p">;</span>
the exact distribution terms <span class="k">for </span>each program are described <span class="k">in </span>the
individual files <span class="k">in</span> /usr/share/doc/<span class="k">*</span>/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

pokemon@root:~<span class="nv">$ </span>
</code></pre></div></div>
<p>Hemos conseguido asÃ­ una consola interactiva. Desde este punto e investigando un poco hayamos el primer pokemon:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pokemon@root:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-R</span>
.:
Desktop  Documents  Downloads  examples.desktop  Music  Pictures  Public  Templates  Videos

./Desktop:
P0kEmOn.zip

./Documents:

./Downloads:

./Music:

./Pictures:

./Public:

./Templates:

./Videos:
Gotta

./Videos/Gotta:
Catch

./Videos/Gotta/Catch:
Them

./Videos/Gotta/Catch/Them:
ALL!

./Videos/Gotta/Catch/Them/ALL!:
Could_this_be_what_Im_looking_for?.cplusplus
</code></pre></div></div>

<p>Nos metemos en el directorio Desktop y descomprimimos el archivo:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pokemon@root:~/Desktop<span class="nv">$ </span>unzip P0kEmOn.zip 
Archive:  P0kEmOn.zip
   creating: P0kEmOn/
  inflating: P0kEmOn/grass-type.txt  
</code></pre></div></div>

<p>Abrimos el archivo y nos reporta la soluciÃ³n en hexadecimal por lo que con el comnado xxd terminamos de resolverlo:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pokemon@root:~/Desktop/P0kEmOn<span class="nv">$ </span><span class="nb">cat </span>grass-type.txt 
50 6f 4b 65 4d 6f 4e 7b 42 75 6c 62 61 73 61 75 72 7d
pokemon@root:~/Desktop/P0kEmOn<span class="nv">$ </span><span class="nb">cat </span>grass-type.txt | xxd <span class="nt">-r</span> <span class="nt">-p</span>
???????<span class="o">{</span>????????<span class="o">}</span>
</code></pre></div></div>

<p>Cuando hemos hecho ls -R, nos hemos dado cuenta de que existe un directorio (./Videos/Gotta/Catch/Them/All!:) con un archivo que puede que contenga informaciÃ³n importante. Nos dirigimos a el y lo abrimos:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pokemon@root:~<span class="nv">$ </span><span class="nb">cd </span>Videos/Gotta/Catch/Them/ALL<span class="se">\!</span>/
pokemon@root:~/Videos/Gotta/Catch/Them/ALL!<span class="nv">$ </span><span class="nb">ls
</span>Could_this_be_what_Im_looking_for?.cplusplus
pokemon@root:~/Videos/Gotta/Catch/Them/ALL!<span class="nv">$ </span><span class="nb">cat </span>Could_this_be_what_Im_looking_for<span class="se">\?</span>.cplusplus 
<span class="c"># include &lt;iostream&gt;</span>

int main<span class="o">()</span> <span class="o">{</span>
        std::cout &lt;&lt; <span class="s2">"??? : ????????"</span>
        <span class="k">return </span>0<span class="p">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="escalada-de-privilegios"><a href="$header-1"></a>Escalada de privilegios</h1>

<p>Parece ser que tenemos otro usuario y contraseÃ±a por lo que inetntamos conectarnos a el por SHH con:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pokemon@root:~/Videos/Gotta/Catch/Them/ALL!<span class="nv">$ </span>ssh ash@10.10.224.44
The authenticity of host <span class="s1">'10.10.224.44 (10.10.224.44)'</span> can<span class="s1">'t be established.
ECDSA key fingerprint is SHA256:mXXTCQORSu35gV+cSi+nCjY/W0oabQFNjxuXUDrsUHI.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span>10.10.224.44<span class="s1">' (ECDSA) to the list of known hosts.
ash@10.10.224.44'</span>s password: 
Welcome to Ubuntu 16.04.6 LTS <span class="o">(</span>GNU/Linux 4.15.0-112-generic x86_64<span class="o">)</span>

 <span class="k">*</span> Documentation:  https://help.ubuntu.com
 <span class="k">*</span> Management:     https://landscape.canonical.com
 <span class="k">*</span> Support:        https://ubuntu.com/advantage

84 packages can be updated.
0 updates are security updates.


The programs included with the Ubuntu system are free software<span class="p">;</span>
the exact distribution terms <span class="k">for </span>each program are described <span class="k">in </span>the
individual files <span class="k">in</span> /usr/share/doc/<span class="k">*</span>/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.


The programs included with the Ubuntu system are free software<span class="p">;</span>
the exact distribution terms <span class="k">for </span>each program are described <span class="k">in </span>the
individual files <span class="k">in</span> /usr/share/doc/<span class="k">*</span>/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Could not chdir to home directory /home/ash: Permission denied
<span class="err">$</span>
</code></pre></div></div>

<p>Nos reporta una consola. En este punto podemos hacer sudo -l para ver los permisos que tiene el usuario:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>ash: 
Matching Defaults entries <span class="k">for </span>ash on root:
    env_reset, mail_badpass,
    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User ash may run the following commands on root:
    <span class="o">(</span>ALL : ALL<span class="o">)</span> ALL
</code></pre></div></div>

<p>Vemos que puede usar todos los comandos como sudo. Nos dirigimos entonces a /home para ver su contenido. En el aparece el usuario ash y el archivo roots-pokemon.txt</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /home
<span class="nv">$ </span><span class="nb">ls
</span>ash  pokemon  roots-pokemon.txt
</code></pre></div></div>

<p>Como somos el usuario ash y este puede usar todos los comandos como root intentamos abrir el archivo roots-pokemon.txt</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo cat </span>roots-pokemon.txt
???????!
</code></pre></div></div>

<p>Obtenemos el pokemon favorito de root y solo nos quedarÃ­a el tipo agua y fuego. Para ello, podemos buscar archivos que se llamen ???water???.txt y ???fire???.txt</p>

<p>Lo hacemos de esta forma:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>find / <span class="nt">-type</span> f <span class="nt">-name</span> <span class="k">*</span>water<span class="k">*</span>.txt 2&gt;/dev/null
/var/www/html/water-type.txt
<span class="nv">$ </span><span class="nb">sudo cat</span> /var/www/html/water-type.txt
Ecgudfxq_EcGmP<span class="o">{</span>Ecgudfxq<span class="o">}</span>
</code></pre></div></div>

<p>Parece ser que se ha aplicado una rotaciÃ³n en el texto. Para solucionar esto, podemos dirigirnos a <a href="https://rot13.com">rot13</a> y probar con distintas rotaciones. Damos asÃ­ con la respuesta al tipo agua. Hacemos lo mismo con el tipo fuego:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>find / <span class="nt">-type</span> f <span class="nt">-name</span> <span class="k">*</span>fire<span class="k">*</span>.txt 2&gt;/dev/null
/etc/why_am_i_here?/fire-type.txt
<span class="nv">$ </span><span class="nb">sudo cat</span> /etc/why_am_i_here?/fire-type.txt
<span class="nv">UDBrM20wbntDaGFybWFuZGVyfQ</span><span class="o">==</span>
</code></pre></div></div>

<p>Ocurre lo mismo que la flag anterior. No nos dan el texto claro. Observando un poco el texto, podemos deducir que estÃ¡ en base64. Podemos descifrarlo entonces desde la consola con:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo cat</span> /etc/why_am_i_here?/fire-type.txt | <span class="nb">base64</span> <span class="nt">-d</span>
???????<span class="o">{</span>??????????<span class="o">}</span>
</code></pre></div></div>

<p>Obtenemos asÃ­ todas las flags!</p>

<p>Muchas gracias por leer este writeup, espero que te haya gustado!</p>
:ET